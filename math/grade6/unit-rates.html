<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Grade 6 ‚Äî Unit Rates</title>
<style>
:root{
  --bg:#f7fbff; --panel:#fff; --accent:#60a5fa; --accent2:#1d4ed8; --ok:#16a34a; --bad:#ef4444; --muted:#566270;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter, "Segoe UI", Arial, sans-serif;background:var(--bg);color:#04263b;}
header{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;padding:22px 12px;text-align:center}
header h1{margin:0;font-size:clamp(20px,3vw,30px)}
main{max-width:1100px;margin:20px auto;padding:14px}
section{background:var(--panel);border-radius:12px;padding:16px;margin:14px 0;box-shadow:0 8px 24px rgba(2,6,23,0.06)}
h2{color:var(--accent2);margin:0 0 10px 0}
p{margin:8px 0}
.controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
button{background:var(--accent2);color:#fff;border:none;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:700}
button.secondary{background:#60a5fa;color:#fff}
button.ghost{background:#dbeafe;color:var(--accent2);border:1px solid #93c5fd}
button.warn{background:#f97316}
input[type=number], input[type=text], select{padding:8px;border-radius:8px;border:1px solid #93c5fd;font-size:1rem}
.grid{display:grid;gap:10px}
.grid.cols-4{grid-template-columns:repeat(4,1fr)}
.tile{background:#fff;padding:12px;border-radius:8px;text-align:center;border:1px solid #93c5fd;cursor:pointer;font-weight:700}
.status{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.pill{background:#e6ffef;color:var(--ok);padding:6px 10px;border-radius:999px;font-weight:800}
.muted{color:var(--muted)}
footer{text-align:center;padding:12px;margin-top:8px;color:#334155}
.answer{font-weight:800;margin-top:8px}
.ok{color:var(--ok)}
.bad{color:var(--bad)}
canvas{background:#fff;border:1px solid #93c5fd;border-radius:8px;display:block;margin-top:10px;}
</style>
<script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
<header>
<h1>Grade 6 ‚Äî Unit Rates</h1>
<p style="margin:6px 0 0 0;opacity:.95">Interactive lesson ‚Ä¢ practice problems ‚Ä¢ speed quiz</p>
</header>

<main>
<section aria-labelledby="introTitle">
<h2 id="introTitle">What is a Unit Rate?</h2>
<p>A **unit rate** is a special kind of ratio where the second term is 1. It tells you how much of something you get per single unit of something else. For example, if a car travels 60 miles in one hour, the unit rate is 60 miles per hour.</p>
<p>Unit rates are super useful for comparing things! Imagine you're at the grocery store comparing two different sizes of cereal boxes. You can use the unit rate to find the best price per ounce.</p>
<div class="status" style="margin-top:8px">
  <div class="pill" id="score">Score: 0</div>
  <div class="muted" id="streak">Streak: 0</div>
</div>
</section>

<section aria-labelledby="videoTitle">
<h2 id="videoTitle">Video: Unit Rates Explained!</h2>
<p>Watch this video to see how to find a unit rate! üé•</p>
<div class="canvas-wrapper">
  <canvas id="tutorialCanvas" width="800" height="400"></canvas>
</div>
<div class="controls">
  <button id="playTutorial" class="secondary">‚ñ∂Ô∏è Play Video</button>
</div>
<div class="settings">
  <label>Speed: <input type="number" id="videoSpeed" value="1" min="0.5" max="2" step="0.1"></label>
</div>
</section>

<section aria-labelledby="simplifyTitle">
<h2 id="simplifyTitle">Find the Unit Rate</h2>
<p>To find the unit rate, divide the first number by the second number. Don't forget to include the correct unit!</p>
<div class="grid cols-4" style="margin-top:10px">
  <div class="tile">
    <div style="font-weight:700">1) 120 miles in 4 hours</div>
    <input id="q1" type="text" placeholder="e.g. 30 mph">
    <div style="margin-top:6px"><button onclick="check('q1','30 mph')">Check</button></div>
    <div id="r1" class="answer"></div>
  </div>
  <div class="tile">
    <div style="font-weight:700">2) $24 for 6 water bottles</div>
    <input id="q2" type="text" placeholder="e.g. $4 per bottle">
    <div style="margin-top:6px"><button onclick="check('q2','$4 per bottle')">Check</button></div>
    <div id="r2" class="answer"></div>
  </div>
  <div class="tile">
    <div style="font-weight:700">3) 150 words in 3 minutes</div>
    <input id="q3" type="text" placeholder="e.g. 50 words per minute">
    <div style="margin-top:6px"><button onclick="check('q3','50 words per minute')">Check</button></div>
    <div id="r3" class="answer"></div>
  </div>
  <div class="tile">
    <div style="font-weight:700">4) 600 calories in 10 servings</div>
    <input id="q4" type="text" placeholder="e.g. 60 calories per serving">
    <div style="margin-top:6px"><button onclick="check('q4','60 calories per serving')">Check</button></div>
    <div id="r4" class="answer"></div>
  </div>
</div>
</section>

<section aria-labelledby="speedTitle">
<h2 id="speedTitle">‚ö° Unit Rate Speed Quiz</h2>
<div class="controls">
  <label>Duration:
    <select id="quizDuration">
      <option value="30">30s</option>
      <option value="60" selected>60s</option>
      <option value="90">90s</option>
    </select>
  </label>
  <button id="startQuiz" class="warn">Start Quiz</button>
  <button id="stopQuiz" class="ghost">Stop</button>
  <div class="muted" id="quizTimer">Time: 0</div>
  <div id="quizScore" class="pill">Correct: 0</div>
</div>
<div style="margin-top:12px">
  <div style="font-size:1.6rem;font-weight:800" id="quizQ">Press Start</div>
  <div style="margin-top:8px" class="controls">
    <input id="quizInput" type="text" placeholder="Answer">
    <button id="quizCheck" class="secondary">Submit</button>
    <div id="quizFeedback" class="answer"></div>
  </div>
</div>
</section>

<section aria-labelledby="csvTitle">
<h2 id="csvTitle">Download CSV Log</h2>
<p>Track all practice & quiz answers in a CSV file.</p>
<button id="downloadCSVBtn" class="secondary">‚¨áÔ∏è Download CSV</button>
</section>

<footer>Finding the unit rate is just a division problem!</footer>
</main>

<script>
/* ===== Utilities ===== */
const tone = (f = 880, d = 0.06) => {
    try {
        const A = new (window.AudioContext || window.webkitAudioContext)();
        const o = A.createOscillator();
        const g = A.createGain();
        o.type = 'sine';
        o.frequency.value = f;
        g.gain.value = 0.0001;
        o.connect(g);
        g.connect(A.destination);
        o.start();
        g.gain.exponentialRampToValueAtTime(0.12, A.currentTime + 0.01);
        g.gain.exponentialRampToValueAtTime(0.0001, A.currentTime + d);
        setTimeout(() => { o.stop(); A.close().catch(() => {}); }, d * 1000 + 50);
    } catch (e) {}
};
let totalScore = 0, streak = 0, csvData = [['Question', 'User Answer', 'Correct Answer']];
function updateScore(points) {
    if (points > 0) {
        totalScore += points;
        streak++;
    } else {
        streak = 0;
    }
    document.getElementById('score').textContent = `Score: ${totalScore}`;
    document.getElementById('streak').textContent = `Streak: ${streak}`;
}
window.check = (inputId, correct) => {
    const val = document.getElementById(inputId).value.trim().toLowerCase();
    
    // Correctly get the result element's ID
    const resultId = 'r' + inputId.slice(1);
    const res = document.getElementById(resultId);

    // Guardrail to prevent TypeError if element is not found
    if (!res) {
        console.error(`Result element with ID '${resultId}' not found.`);
        return;
    }

    const questionText = document.getElementById(inputId).previousElementSibling.textContent;
    if (val === correct.toLowerCase()) {
        res.textContent = '‚úÖ Correct!';
        res.className = 'answer ok';
        tone(880, 0.06);
        updateScore(1);
        csvData.push([questionText, val, correct]);
    } else {
        res.textContent = `‚ùå Wrong (Answer: ${correct})`;
        res.className = 'answer bad';
        tone(220, 0.06);
        updateScore(0);
        csvData.push([questionText, val, correct]);
    }
};

/* ===== Canvas Tutorial ===== */
const tutorialCanvas = document.getElementById('tutorialCanvas');
const ctx = tutorialCanvas.getContext('2d');
const tutorialSpeedInput = document.getElementById('videoSpeed');
const voice = window.speechSynthesis.getVoices().find(v => v.name.includes('female') || v.name.includes('F'));

function drawLesson(step) {
    ctx.clearRect(0, 0, tutorialCanvas.width, tutorialCanvas.height);
    const textX = tutorialCanvas.width / 2;
    const textY = 40;
    
    ctx.font = '32px Arial';
    ctx.textAlign = 'center';
    ctx.fillStyle = '#04263b';
    ctx.fillText(step.text, textX, textY);
    
    if (step.image) {
        const img = new Image();
        img.src = step.image;
        img.onload = () => {
            const scale = Math.min(tutorialCanvas.width / img.width, tutorialCanvas.height / img.height);
            const w = img.width * scale * 0.8;
            const h = img.height * scale * 0.8;
            const x = (tutorialCanvas.width - w) / 2;
            const y = (tutorialCanvas.height - h) / 2;
            ctx.drawImage(img, x, y, w, h);
        };
    }
    
    if (step.textLines) {
        ctx.font = '40px Arial';
        ctx.textAlign = 'center';
        let y = tutorialCanvas.height / 2 - (step.textLines.length - 1) * 30;
        step.textLines.forEach((line) => {
            ctx.fillText(line, tutorialCanvas.width / 2, y);
            y += 60;
        });
    }

    if (step.equation) {
        ctx.font = '60px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(step.equation, tutorialCanvas.width / 2, tutorialCanvas.height / 2);
    }
}

const tutorialSteps = [
    { audio: "Today we will learn about unit rates. A unit rate is a ratio where the second number is 1.", text: "What is a Unit Rate?" },
    { audio: "For example, imagine a car that drives 120 miles in 4 hours.", text: "120 miles in 4 hours", image: "https://placehold.co/200x100/A5C9CA/04263B?text=Car" },
    { audio: "To find the unit rate, we need to know how many miles the car travels in just one hour.", text: "Finding the Unit Rate", textLines: ["120 miles", "4 hours"] },
    { audio: "We find the unit rate by dividing the first number by the second number. So we divide 120 by 4.", text: "Divide to find the rate", equation: "120 √∑ 4" },
    { audio: "120 divided by 4 is 30. So the car travels 30 miles per hour.", text: "The Unit Rate", textLines: ["30 miles", "per 1 hour"] },
    { audio: "Let's try another example. What if you pay $10 for 5 oranges?", text: "Another Example", textLines: ["$10", "5 oranges"] },
    { audio: "To find the price for one orange, we divide 10 by 5.", text: "Divide to find the price", equation: "10 √∑ 5" },
    { audio: "10 divided by 5 is 2. The unit rate is $2 per orange.", text: "The Unit Rate", textLines: ["$2", "per orange"] },
    { audio: "You've got this! Now let's practice.", text: "You did it!" }
];

let tutorialIndex = 0;
async function playTutorialVideo(callback) {
    if (speechSynthesis.speaking) return;
    tutorialIndex = 0;
    const speed = parseFloat(tutorialSpeedInput.value) || 1;
    function nextStep() {
        if (tutorialIndex >= tutorialSteps.length) {
            if (callback) callback();
            return;
        }
        const step = tutorialSteps[tutorialIndex];
        drawLesson(step);
        
        const utterance = new SpeechSynthesisUtterance(step.audio);
        utterance.rate = speed;
        utterance.pitch = 1.2;
        utterance.volume = 1;
        if (voice) utterance.voice = voice;
        utterance.onend = () => {
            tutorialIndex++;
            nextStep();
        };
        utterance.onerror = () => {
            tutorialIndex++;
            nextStep();
        };
        speechSynthesis.speak(utterance);
    }
    nextStep();
}
document.getElementById('playTutorial').addEventListener('click', () => playTutorialVideo());
drawLesson({text: "Unit Rates"});


/* ===== Score & Streak ===== */
function updateScore(points) {
    if (points > 0) {
        totalScore += points;
        streak++;
    } else {
        streak = 0;
    }
    document.getElementById('score').textContent = `Score: ${totalScore}`;
    document.getElementById('streak').textContent = `Streak: ${streak}`;
}


/* ===== Speed Quiz ===== */
function generateUnitRateProblem() {
    const scenarios = [
        { type: 'miles_per_hour', units: ['miles', 'hours'], answerUnit: 'mph' },
        { type: 'cost_per_item', units: ['dollars', 'items'], answerUnit: 'per item' },
        { type: 'words_per_minute', units: ['words', 'minutes'], answerUnit: 'words per minute' },
        { type: 'calories_per_serving', units: ['calories', 'servings'], answerUnit: 'calories per serving' }
    ];
    const scenario = scenarios[Math.floor(Math.random() * scenarios.length)];
    
    let value1, value2, answer;
    if (scenario.type === 'cost_per_item') {
        value2 = Math.floor(Math.random() * 8) + 2;
        answer = Math.floor(Math.random() * 8) + 2;
        value1 = value2 * answer;
        return { q: `Find the unit rate for $${value1} for ${value2} items.`, a: `$${answer} ${scenario.answerUnit}` };
    } else {
        value2 = Math.floor(Math.random() * 8) + 2;
        answer = Math.floor(Math.random() * 30) + 20;
        value1 = value2 * answer;
        return { q: `Find the unit rate for ${value1} ${scenario.units[0]} in ${value2} ${scenario.units[1]}.`, a: `${answer} ${scenario.answerUnit}` };
    }
}

let quizTimerInt = null, quizTime = 0, quizScore = 0, currentQuiz = null;

function newQuizQuestion() {
    const problem = generateUnitRateProblem();
    currentQuiz = problem;
    document.getElementById('quizQ').textContent = currentQuiz.q;
    document.getElementById('quizInput').value = '';
    document.getElementById('quizFeedback').textContent = '';
}

document.getElementById('startQuiz').addEventListener('click', () => {
    quizTime = parseInt(document.getElementById('quizDuration').value, 10);
    quizScore = 0;
    document.getElementById('quizScore').textContent = `Correct: ${quizScore}`;
    newQuizQuestion();
    clearInterval(quizTimerInt);
    quizTimerInt = setInterval(() => {
        quizTime--;
        document.getElementById('quizTimer').textContent = `Time: ${quizTime}s`;
        if (quizTime <= 0) {
            clearInterval(quizTimerInt);
            document.getElementById('quizQ').textContent = 'Time Up!';
        }
    }, 1000);
});
document.getElementById('stopQuiz').addEventListener('click', () => {
    clearInterval(quizTimerInt);
});
document.getElementById('quizCheck').addEventListener('click', () => {
    const val = document.getElementById('quizInput').value.trim().toLowerCase();
    const f = document.getElementById('quizFeedback');
    let userAnswer = val;
    let correctAnswer = currentQuiz.a;

    if (val === currentQuiz.a.toLowerCase()) {
        f.textContent = '‚úÖ Correct!';
        f.className = 'answer ok';
        quizScore++;
        document.getElementById('quizScore').textContent = `Correct: ${quizScore}`;
        tone(880, 0.06);
    } else {
        f.textContent = `‚ùå Wrong (Answer: ${currentQuiz.a})`;
        f.className = 'answer bad';
        tone(220, 0.06);
    }
    csvData.push([currentQuiz.q, userAnswer, correctAnswer]);
    if (quizTime > 0) newQuizQuestion();
});

/* ===== CSV Download ===== */
document.getElementById('downloadCSVBtn').addEventListener('click', () => {
    const csvContent = "data:text/csv;charset=utf-8," + csvData.map(e => e.join(",")).join("\n");
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "unit_rates_log.csv");
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
});
</script>
</body>
</html>
