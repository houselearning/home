<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>3rd Grade Math: Bar Graph Studio (7-Step Masterclass)</title>
    
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script>
    window.MathJax = { tex: { inlineMath: [['$', '$']], displayMath: [['$$', '$$']] } };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <style>
    :root {
      --graph-purple: #8e44ad;
      --graph-blue: #3498db;
      --studio-bg: #f5f6fa;
      --success: #27ae60;
      --locked: #bdc3c7;
    }

    body { margin: 0; font-family: "Segoe UI", sans-serif; background: var(--studio-bg); display: flex; height: 100vh; overflow: hidden; }
    
    nav { width: 320px; background: white; border-right: 2px solid var(--graph-purple); display: flex; flex-direction: column; flex-shrink: 0; }
    .nav-header { padding: 25px; background: var(--graph-purple); color: white; }
    .nav-item { padding: 12px 20px; border-bottom: 1px solid #eee; color: #7f8c8d; font-size: 13px; cursor: pointer; position: relative; }
    .nav-item.active { background: #f3e5f5; color: var(--graph-purple); font-weight: bold; border-left: 6px solid var(--graph-purple); }
    .nav-item.locked { color: var(--locked); cursor: not-allowed; }
    .nav-item.locked::after { content: 'üîí'; position: absolute; right: 15px; }
    .nav-item.completed::after { content: '‚úÖ'; position: absolute; right: 15px; }

    main { flex: 1; overflow-y: auto; padding: 40px; display: flex; flex-direction: column; align-items: center; }
    .studio-card { background: white; width: 100%; max-width: 800px; padding: 40px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); display: none; }
    .studio-card.active { display: block; animation: fadeIn 0.4s; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .graph-area { display: flex; align-items: flex-end; justify-content: space-around; height: 250px; border-left: 3px solid #333; border-bottom: 3px solid #333; margin: 40px 0 60px 40px; position: relative; width: 85%; }
    .bar { width: 50px; background: var(--graph-blue); transition: height 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; border-radius: 4px 4px 0 0; z-index: 2; }
    .bar::after { content: attr(data-label); position: absolute; bottom: -35px; left: 50%; transform: translateX(-50%); font-size: 12px; color: #333; font-weight: bold; width: 80px; text-align: center; }
    
    .scale-line { position: absolute; width: 100%; border-top: 1px dashed #ddd; left: 0; z-index: 1; }
    .scale-label { position: absolute; left: -40px; font-size: 12px; transform: translateY(-50%); font-weight: bold; }

    .btn { background: var(--graph-purple); color: white; border: none; padding: 14px 28px; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 20px; }
    .answer-input { font-size: 28px; padding: 10px; width: 100px; text-align: center; border: 3px solid var(--graph-purple); border-radius: 8px; outline: none; }
    .progress-bar { height: 8px; background: #eee; border-radius: 4px; margin-bottom: 20px; overflow: hidden; }
    #pb-fill { height: 100%; background: var(--success); width: 0%; transition: 0.4s; }
  </style>
</head>
<body>

  <nav>
    <div class="nav-header"><strong>üìä Graph Studio</strong><div id="perc" style="font-size:11px; margin-top:5px;">Loading...</div></div>
    <div id="nav-list">
      <div id="nav-0" class="nav-item active" onclick="showPage(0)">1. üé¨ Anatomy of a Graph</div>
      <div id="nav-1" class="nav-item locked" onclick="showPage(1)">2. üìú The Secret of Scales</div>
      <div id="nav-2" class="nav-item locked" onclick="showPage(2)">3. üü¢ Level 1: Basic Counts</div>
      <div id="nav-3" class="nav-item locked" onclick="showPage(3)">4. üü° Level 2: Scale of 2s</div>
      <div id="nav-4" class="nav-item locked" onclick="showPage(4)">5. üü† Level 3: Scale of 5s</div>
      <div id="nav-5" class="nav-item locked" onclick="showPage(5)">6. üî¥ Level 4: The Comparison</div>
      <div id="nav-6" class="nav-item locked" onclick="showPage(6)">7. üèÜ Creative Director</div>
    </div>
  </nav>

  <main>
    <div id="p0" class="studio-card active">
      <h1>Making Data Visual</h1>
      <p>A bar graph uses rectangles (bars) to show how many are in each group. It helps us see "Most" and "Least" instantly!</p>
      <div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;border-radius:10px;">
        <iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="https://www.youtube.com/embed/oZ_asSHeqAc" frameborder="0" allowfullscreen></iframe>
      </div>
      <button class="btn" onclick="saveStepProgress(0, 1)">Analyze Labels</button>
    </div>

    <div id="p1" class="studio-card">
        <h1>The Rule of Intervals</h1>
        <p>In 3rd grade, you'll see graphs where the numbers on the side jump by more than 1. This jump is called the <strong>Interval</strong>.</p>
        <div style="background:#f3e5f5; padding:20px; border-radius:8px; border-left:6px solid var(--graph-purple);">
            If the scale goes $0, 5, 10, 15$... then a bar that hits the second line equals **10**, not 2!
        </div>
        <button class="btn" onclick="saveStepProgress(1, 2)">Test Your Eyes</button>
    </div>

    <div id="p-practice" class="studio-card">
      <div class="progress-bar"><div id="pb-fill"></div></div>
      <h2 id="q-title">Level</h2>
      <p id="q-instr">Examine the graph carefully:</p>
      
      <div class="graph-area" id="graph-target"></div>

      <div style="text-align: center;">
        <span id="question-text" style="font-size: 18px; display: block; margin-bottom: 15px; font-weight:bold;">How many?</span>
        <input type="number" id="q-input" class="answer-input">
        <button class="btn" onclick="checkPractice()">Verify Data</button>
        <div id="feedback" style="margin-top:20px; font-weight:bold; height:24px;"></div>
      </div>
    </div>

    <div id="p6" class="studio-card" style="text-align:center;">
      <h1 style="font-size: 70px;">üèÜ</h1>
      <h1>Creative Director Status</h1>
      <p>Your ability to interpret complex scales and compare data sets is top-tier. Your report is ready for the board of directors!</p>
      <button id="mastery-btn" class="btn" disabled onclick="saveStepProgress(6, 6)">Publish Studio Results</button>
    </div>
  </main>

  <script>
    const lessonID = "3rd_grade_bargraphs_7step";
    const firebaseConfig = {
      apiKey: "AIzaSyDoXSwni65CuY1_32ZE8B1nwfQO_3VNpTw",
      authDomain: "contract-center-llc-10.firebaseapp.com",
      projectId: "contract-center-llc-10",
      storageBucket: "contract-center-llc-10.firebasestorage.app",
      messagingSenderId: "323221512767",
      appId: "1:323221512767:web:6421260f875997dbf64e8a"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let stepsCompleted = {};
    let currentStep = 0;
    let practiceCount = 0;
    let currentA = 0;

    auth.onAuthStateChanged(user => { if (user) syncProgress(user); });

    async function syncProgress(user) {
      const doc = await db.collection('UserLessonProgress').doc(user.uid).collection('lessons').doc(lessonID).get();
      stepsCompleted = doc.exists ? doc.data().steps : { step_0:false, step_1:false, step_2:false, step_3:false, step_4:false, step_5:false, step_6:false };
      updateSidebar();
    }

    async function saveStepProgress(stepIdx, nextIdx) {
      stepsCompleted[`step_${stepIdx}`] = true;
      await db.collection('UserLessonProgress').doc(auth.currentUser.uid).collection('lessons').doc(lessonID).set({ steps: stepsCompleted }, { merge: true });
      updateSidebar();
      if(stepIdx !== nextIdx) showPage(nextIdx);
    }

    function updateSidebar() {
      let count = 0;
      for(let i=0; i<7; i++) {
        const item = document.getElementById(`nav-${i}`);
        const isDone = stepsCompleted[`step_${i}`];
        const isPrevDone = i === 0 || stepsCompleted[`step_${i-1}`];
        item.className = 'nav-item' + (currentStep === i ? ' active' : '') + (isDone ? ' completed' : '') + (!isPrevDone ? ' locked' : '');
        if(isDone) count++;
      }
      document.getElementById('perc').textContent = `Studio Ready: ${Math.round(count/7*100)}%`;
      document.getElementById('mastery-btn').disabled = !stepsCompleted.step_5;
    }

    function showPage(index) {
      if(index > 0 && !stepsCompleted[`step_${index-1}`]) return;
      document.querySelectorAll('.studio-card').forEach(c => c.classList.remove('active'));
      currentStep = index;
      const id = (index >= 2 && index <= 5) ? 'p-practice' : 'p' + index;
      document.getElementById(id).classList.add('active');
      updateSidebar();
      if(index >= 2 && index <= 5) setupLevel(index);
    }

    function setupLevel(level) {
      practiceCount = 0;
      document.getElementById('pb-fill').style.width = '0%';
      genGraph(level);
    }

    function genGraph(level) {
      const graph = document.getElementById('graph-target');
      graph.innerHTML = '';
      
      let interval = (level === 2) ? 1 : (level === 3) ? 2 : (level === 4) ? 5 : (Math.random() > 0.5 ? 2 : 5);
      let maxVal = interval * 10;

      for(let i=0; i<=maxVal; i+=interval) {
        let line = document.createElement('div');
        line.className = 'scale-line';
        line.style.bottom = (i/maxVal * 100) + '%';
        line.innerHTML = `<span class="scale-label">${i}</span>`;
        graph.appendChild(line);
      }

      const cats = ["Apples", "Bananas", "Grapes"];
      const values = cats.map(() => (Math.floor(Math.random() * 8) + 1) * interval);
      
      cats.forEach((c, i) => {
        let bar = document.createElement('div');
        bar.className = 'bar';
        bar.style.height = (values[i]/maxVal * 100) + '%';
        bar.setAttribute('data-label', c);
        graph.appendChild(bar);
      });

      if(level <= 4) {
        let targetIdx = Math.floor(Math.random() * 3);
        document.getElementById('q-title').textContent = `Reading Scale: ${interval}s`;
        document.getElementById('question-text').textContent = `How many ${cats[targetIdx]} were collected?`;
        currentA = values[targetIdx];
      } else {
        document.getElementById('q-title').textContent = "Data Comparison";
        let diff = values[0] - values[2];
        document.getElementById('question-text').textContent = (diff >= 0) ? 
          `How many more Apples than Grapes?` : `How many more Grapes than Apples?`;
        currentA = Math.abs(diff);
      }
      document.getElementById('q-input').value = '';
      document.getElementById('feedback').textContent = '';
      document.getElementById('q-input').focus();
    }

    function checkPractice() {
      const val = parseInt(document.getElementById('q-input').value);
      const fb = document.getElementById('feedback');
      if(val === currentA) {
        fb.style.color = "var(--success)";
        fb.textContent = "Accurate reporting! üìà";
        practiceCount++;
        document.getElementById('pb-fill').style.width = (practiceCount/3 * 100) + '%';
        if(practiceCount >= 3) setTimeout(() => saveStepProgress(currentStep, currentStep + 1), 1000);
        else setTimeout(() => genGraph(currentStep), 1000);
      } else {
        fb.style.color = "red";
        fb.textContent = `Check the side scale! Each line is ${ (currentStep === 4) ? 5 : (currentStep === 3) ? 2 : 1 }.`;
      }
    }
  </script>
</body>
</html>
